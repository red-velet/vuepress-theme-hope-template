# 一、第一章 概述

## 1、因特网概述

### 1.1 基本概念

::: info 网络、互联网(internet)、因特网(Internet)的基本概念

:::

- 网络：由若干**结点（Node）**和连接这些结点的**链路（Link）**组成就是**网络（Network）**。
- 互联网：多个网络通过路由器互连起来，这样就构成了一个覆盖范围更大的网络，即互连网（互联网）。因此，互联网又称为 `网络的网络（Network of Networks）`。
- 因特网：因特网是世界上最大的互连网络

![network_details](./img/network_details.png)



### 1.2 区别

::: tip **internet与Internet的区别**

* **internet(互联网或互连网)**是一个通用名词，它泛指**多个计算机网络互连而成的网络**。在这些网络之间的通信协议可以是任意的。
* **Internet（因特网）则是一个专用名词**，它指**当前全球最大的、开放的、由众多网络互连而成的特定计算机网络**，它采用TCP/IP协议族作为通信的规则，其前身是美国的ARPANET。

**任意把几个计算机网络互连起来（不管采用什么协议），并能够相互通信，这样构成的是一个互连网(internet) ，而不是互联网(Internet)。**

:::



## 2、三种交换方式

::: tip 

​	网络中最复杂的部分是网络核心部分，它的主要任务是为边缘部分中的大量主机提供连通性，以便它们能够相互通信并传输数据。在网络核心部分中，路由器扮演着重要的角色，作为实现分组交换的关键构件，其最重要的功能是转发收到的分组。

:::

### 2.1 电路交换

> 描述：电话交换机接通电话线的方式称为电路交换；

* 从通信资源的分配角度来看，交换（Switching）就是按照某种方式动态地分配传输线路的资源；

* 电路交换的三个步骤：

  1、建立连接（分配通信资源）

  2、通话（一直占用通信资源）

  3、释放连接（归还通信资源）

---

**（1）传统两两相连的方式**

通过一根电话线，两两相连接的方式

![image-20230509165558786](./img/image-20230509165558786.png)



**（2）电话交换机方式**

为了解决传统两两相连方式下当电话数量很多时需要大量电话线的不便，需要使用一个中间设备来连接每一部电话，这个设备就是电话交换机。这样，每一部电话都可以方便地和另一部电话进行通信。

![Circuit_switch](./img/Circuit_switch.png)







### 2.2 分组交换

> **描述：分组交换是将一个完整的数据流（如一个文件或一个视频）分割成多个数据包（即分组），每个分组都带有目的地址和源地址信息，并通过计算机网络独立传输。在传输过程中，每个分组都经过路由器进行转发，根据目的地址找到下一个路由器或主机，并且每个分组可能沿着不同的路径到达目的地。一旦所有分组到达目的地，它们会按照先后顺序组合成原始数据流。**

::: info 分组交换

1. 通常我们把表示**该消息的整块数据**成为一个**报文**。
2. 在发送报文之前，先把较长的报文划分成一个个更小的**等长数据段**，在每一个数据段前面。加上一些由必**要的控制信息组成的首部**后，就构成一个分组，也可简称为 "包"，相应地，首部也可称为 "包头"。
3. 首部包含了**分组的目的地址**
4. 分组从源主机到目的主机，可走不同的路径。

:::

---

**（1）发送方作用**

* 构造分组
* 发送分组



**（2）路由器作用**

* 缓存分组
* 转发分组，简称为"分组转发"



**（3）接收方作用**

* 接收分组
* 还原报文



::: tip 处理转发的方式- 存储转发：

由于路由器的输入和输出端口之间没有直接连线，分组需要暂时存储在路由器内存中，然后根据目的地址查找转发表，并将分组转发到相应的端口。

路由器处理分组的过程是：

1. 把收到的分组先**放入缓存（暂时存储）；**
2. **查找转发表**，找出到某个目的地址应从哪个端口转发；
3. 把分组送到适当的端口**转发**出去。

:::





### 2.3 报文交换

> **概述：报文交换是将一个完整的数据流（如一个文件或一个视频）封装成一个完整的报文，通过计算机网络传输。在传输过程中，每个报文只经过一些路由器，沿着一条确定的路径到达目的地。一旦报文到达目的地，它就被解封，恢复成原始的数据流。**



::: info 报文交换的方式：

报文交换中的交换结点也采用存储转发方式，但**报文交换对报文的大小没有限制，这就要求交换结点需要较大的缓存空间。**报文交换主要用于早期的电报通信网，现在较少使用，**通常被较先进的分组交换方式所取代**。

:::



### 2.4 三种交换方式对比

假设A，B，C，D是分组传输路径所要经过的4个结点交换机，纵坐标为时间

![image-20230509171113207](./img/image-20230509171113207.png)

---

> 过程分析：

:::tabs

@tab 电路交换

电路交换：

1. 通信之前首先要建立连接；
2. 连接建立好之后，就可以使用已建立好的连接进行数据传送；
3. 数据传送后，需释放连接，以归还之前建立连接所占用的通信线路资源。

一旦建立连接，中间的各结点交换机就是直通形式的，比特流可以直达终点；



@tab 报文交换

1. 可以随时发送报文，而不需要事先建立连接；
2. 整个报文先传送到相邻结点交换机，全部存储下来后进行查表转发，转发到下一个结点交换机。
3. 整个报文需要在各结点交换机上进行存储转发。

由于不限制报文大小，因此需要各结点交换机都具有较大的缓存空间。



@tab 分组交换

分组交换：

1. 可以随时发送分组，而不需要事先建立连接。
2. 构成原始报文的一个个分组，依次在各结点交换机上存储转发。各结点交换机在发送分组的同时，还缓存接收到的分组。
3. 构成原始报文的一个个分组，在各结点交换机上进行存储转发。

相比报文交换，减少了转发时延，还可以避免过长的报文长时间占用链路，同时也有利于进行差错控制。

:::

---

> **优点和缺点对比：**

![image-20230509171408456](./img/image-20230509171408456.png)

| 交换方式 | 优点                                     | 缺点                                 |
| -------- | ---------------------------------------- | ------------------------------------ |
| 电路交换 | 通信时延迟小、实时性强                   | 建立连接时间长、线路独占             |
| 报文交换 | 无需建立连接、动态分配线路               | 有转发时延、需要较大的存储缓存空间   |
| 分组交换 | 无需建立连接、动态分配线路、简化存储管理 | 有转发时延；失序、丢失和重复分组问题 |



## 3、计算机网络的定义和分类

### 3.1 定义

::: tip 计算机网络的最简单的定义是：一些互相连接的、自治的计算机的集合。



* 互连：是指计算机之间可以通过有线或无线的方式进行数据通信；
* 自治：是指独立的计算机，他有自己的硬件和软件，可以单独运行使用；
* 集合：是指至少需要两台计算机；

:::

---

::: tip 计算机网络的较好的定义是：计算机网络主要是由一些**通用的，可编程的硬件（一定包含有中央处理机CPU）互连**而成的，而这些硬件并非专门用来实现某一特定目的（例如，传送数据或视频信号）。这些可编程的硬件能够用来**传送多种不同类型的数据**，并能**支持广泛的和日益增长的应用**。

* 计算机网络所连接的硬件，并不限于一般的计算机，而是包括了智能手机等智能硬件。
* 计算机网络并非专门用来传送数据，而是能够支持很多种的应用（包括今后可能出现的各种应用）

:::

---

::: tip 自己的定义：

- 计算机网络是指通过通信设备和通信线路，将分布在不同地理位置的计算机、外围设备及用户连接起来，以实现数据和信息的共享、传输和处理的一种技术体系。
- 计算机网络是由多个计算机、服务器、网络设备和通信协议组成的互联网，它们通过网络传输协议来实现数据交换和通信。

:::

### 3.2 分类

> **计算机网络的分类**：

:::tabs

@tab 按交换技术分类

* 电路交换网络
* 报文交换网络
* 分组交换网络



@tab 按使用者分类

* 公用网：公用网是为了满足广大用户的需求，由政府或私营企业投资建设的，面向广大用户提供通信服务的网络。公用网是基础设施，是支撑信息化建设的重要组成部分。例如，互联网就是一个典型的公用网，用户通过互联网可以访问各种各样的信息，进行各种应用。
* 专用网：专用网是由某个特定单位、组织或个人自己建设的，主要用于满足自身信息传输和处理的需求的网络。专用网通常拥有一定的安全措施，保证数据的机密性和完整性。例如，公司内部的局域网、校园网等都属于专用网的范畴。



@tab 传输介质分类

* 有线网络：有线网络使用物理电缆，如双绞线、同轴电缆、光纤等，作为数据传输的介质。这些介质可以传输高带宽、低延迟的数据信号，传输距离较远时，使用中继器等设备进行信号放大和衰减补偿。常见的有线网络包括以太网、ATM、令牌环等。
* 无线网络：无线网络使用无线电波，如无线局域网（Wi-Fi）、蓝牙、GSM/CDMA等，作为数据传输的介质。无线网络具有灵活性高、部署简单的优点，但其传输距离较短、传输速度较慢、易受到干扰等缺点。常见的无线网络包括无线局域网、蓝牙、移动通信网络等。



@tab 按覆盖范围分类

* 广域网WAN

作用范围通常为几十到几千公里，因而有时也称为远程网（long haul network）。广域网是互联网的核心部分，其任务是通过长距离（例如，跨越不同的国家）运送主机所发送的数据。

* 城域网MAN

作用范围一般是一个城市，可跨越几个街区甚至整个城市

* 局域网LAN

一般用微型计算机或工作站通过高速通信线路相连（速率通常在 10 Mbit/s 以上），但地理上范围较小（1 km 左右）

* 个域网PAN

就是在个人工作的地方把个人使用的电子设备用无线技术连接起来的网络。



@tab 按拓扑结构分类

- 总线型网络
- 星型网络
- 环形网络
- 网状型网络

![tuopu](./img/tuopu.png)

:::



## 4、计算机网络的性能指标

::: tabs



@tab 速率

**(1) 比特**

**计算机中数据量的单位**，也是信息论中信息量的单位。一个比特就是二进制数字中的一个1或0。

```bash
#常用数据量单位
8 bit = 1 Byte
1KB = 1024Byte = 2^10Byte
1MB = 2048Byte = 2^20Byte
1GB = 4096Byte = 2^30Byte
1TB = 8192Byte = 2^40Byte
```

---

**(2) 速率**

速率是指连接在计算机网络上的主机在数字信道上传送比特的速率，也称为**比特率或数据率。**

```bash
#常用数据率单位
bit/s (b/s,bps)
1kb/s = 10^3 b/s
1Mb/s = 10^6 b/s
1Gb/s = 10^9 b/s
1Tb/s = 10^12 b/s
```

**(3) 例题**

```tex
例：有一个待发送的数据块，大小为100MB,网卡的发送速率为100MbPs,则网卡发送完该数据块需要多长时间？
t=100Mbps/100MB
 = 100 * 2^20 * 8 bit / (100*10^6 bit/s)
 = 2^20 * 8 bit  / 10^6 bit/s 
 = 8.388608s
```



@tab 🔺带宽

其实 "带宽" 的这两种表述之间有着密切的联系。一条通信线路的 "频带宽度" 越宽，其所传输数据的 "最高数据率" 也越高。

**(1) 带宽在摸拟信号系统中的意义**

- 信号所包含的各种不同频率成分所占据的频率范围;
- 单位：Hz (kHz，MHz，GHz)

---

**(2)  带宽在计算机网络中的意义**

- 用来表示网络的通信线路所能传送数据的能力
- 网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的 "最高数据率"；
- 单位：b/s (kb/s，Mb/s，Gb/s，Tb/s)





@tab 吞吐量

- 吞吐量表示在单位时间内通过某个网络（或信道、接口）的数据量。
- 吞吐量被经常用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。
- 吞吐量受网络的带宽或额定速率的限制。

![image-20230509174802830](./img/image-20230509174802830.png)

带宽1 Gb/s的以太网，代表其额定速率是1 Gb/s，这个数值也是该以太网的**吞吐量的绝对上限值**。因此，对于带宽1 Gb/s的以太网，可能实际吞吐量只有 700 Mb/s，甚至更低。

注意：吞吐量还可以用每秒传送的字节数或帧数表示。



@tab 🔺时延

时延时指数据（一个报文或分组，甚至比特）从网络（或链路）的一端传送到另一端所需的时间。

网络时延由几部分组成：

* 发送时延：主机或路由器发送数据帧所需要的时间，也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。

* 传播时延：电磁波在信道中传播一定的距离需要花费的时间。

* 处理时延：主机或路由器在收到分组时要花费一定时间进行处理。

* 排队时延：分组在进过网络传输时，要经过许多路由器。但分组在进入路由器后要先在输入队列中排队等待处理。

有时会把排队时延看成**处理时延一部分**；

总时延 = 发送时延 + 传播时延 + 处理时延 （处理时延 + 排队时延）

![image-20230509175023875](./img/image-20230509175023875.png)



@tab 时延带宽积

`时延带宽积 = 传播时延 X 带宽`

![image-20230510093608379](./img/image-20230510093608379.png)

- 若发送端连续发送数据，则在所发送的第一个比特即将到达终点时，发送端就已经发送了时延带宽积个比特；
- 链路的时延带宽积又称为以北比特为单位的链路长度。



@tab 往返时间

互联网上的信息不仅仅单方向传输而是双向交互的。因此，我们有时很需要知道**双向交互一次所需的时间(RTT)**。

![image-20230510093806177](./img/image-20230510093806177.png)



@tab 🔺利用率

![image-20230510093826870](./img/image-20230510093826870.png)



@tab 丢包率

![image-20230510093834067](./img/image-20230510093834067.png)



:::



## 5、计算机网络的体系结构

### 5.1 常见计算机网络体系结构

- OSI 参考模型：由国际标准化组织（ISO）制定，共分为七层，包括物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。
- TCP/IP 参考模型：由美国国防部高级研究计划局（ARPA）制定，共分为四层，包括网络接口层、网络层、传输层和应用层。

![model](./img/model.png)





## 5.2 分层的必要性和各层需要解决的问题

计算机网络采用分层结构的设计方式，主要是为了将复杂的网络系统分解成若干个相对独立、易于理解和设计的模块，从而简化设计和管理。每一层负责不同的功能和任务，通过接口的方式与上下层进行交互和通信，从而实现了网络协议的标准化和互操作性。

下面是各层需要解决的问题：

1. 物理层：负责传输比特流，主要解决物理传输介质、传输速率、传输距离、接口类型等问题。
2. 数据链路层：负责将比特流组装成帧进行传输，主要解决帧的定界、差错检测、如何协调各主机争用总线（流量控制、访问控制）等问题：
   1. 如何标识网络中的各主机（主机编址问题，例如MAC地址）
   2. 如何从信号所表示的一连串比特流中区分出地址和数据
3. 网络层：负责实现不同网络之间的数据传输，主要解决数据路由（如何进行路由选择问题）、网络地址分配（网络和主机共同编址的问题，例如IP地址）
4. 运输层：负责端到端的数据传输，主要解决进程之间基于网络的通信问题，出现传输错误时，如何处理。
5. 应用层：负责为应用程序提供数据传输服务，主要解决应用程序与网络之间的交互问题。

![method](./img/method.png)

---

![image-20230510102855702](./img/image-20230510102855702.png)





## 5.3 分层举例

**解析：**

主机和Web服务器之间基于网络的通信，实际上是主机中的**浏览器应用进程**与Web服务器中的**Web服务器应用进程**之间基于**网络的通信**

![image-20201007145242020](./img/20201016104254.png)



**体系结构的各层在整个过程中起到怎样的作用？**

**1、发送方发送**

![image-20201007145441370](./img/20201016104300.png)

---

> 第一步：
>
> * **应用层**按照HTTP协议的规定构建一个**HTTP请求报文**
> * 应用层将**HTTP请求报文**交付给**运输层**处理

![image-20201007145720661](./img/20201016104304.png)

---

> 第二步：
>
> * **运输层**给**HTTP请求报文**添加一个**TCP首部**，使之成为**TCP报文段**
> * **TCP报文段的首部格式**作用是区分应用进程以及实现可靠传输
> * **运输层**将T**CP报文段**交付给**网络层**处理

![image-20201007150234909](./img/20201016104309.png)

---

> 第三步：
>
> * **网络层**给**TCP报文段**添加一个**IP首部**，使之成为**IP数据报**
> * **IP数据报的首部格式**作用是使**IP数据报**可以在互联网传输，也就是被路由器转发
> * **网络层**将**IP数据报**交付给**数据链路层**处理

![image-20201007150723365](./img/20201016104314.png)

---

> 第四步：
>
> * **数据链路层**给**IP数据报**添加一个**首部**和一个**尾部**，使之成为**帧**     （图示右边为首部，左边为尾部） 
> * 该**首部**的作用主要是为了让**帧**能够在一段链路上或一个网络上传输，能够被相应的目的主机接收
> * 该**尾部**的作用是让目的主机检查所接收到的**帧**是否有误码
> * **数据链路层**将**帧**交付给**物理层**

![image-20201007151342502](./img/20201016104319.png)

---

> 第五步：
>
> * **物理层**先将**帧**看做是**比特流**，这里的网络N1假设是以太网，所以**物理层**还会给该**比特流**前面添加**前导码**
> * **前导码**的作用是为了让目的主机做好接收帧的准备
> * **物理层**将装有**前导码**的**比特流**变换成相应的**信号**发送给传输媒体

![image-20201007151900254](./img/20201016104325.png)

---

> 第六步：**信号**通过**传输媒体**到达**路由器**

**2、路由器转发**

::: tip 存储-在路由器中

:::

* **物理层**将**信号**变为**比特流**，然后去掉**前导码**后，将其交付给**数据链路层**
* **数据链路层**将**帧**的**首部**和**尾部**去掉后，将其交付给**网络层**，这实际交付的是**IP数据报**
* **网络层**解析**IP数据报**的**首部**，从中提取**目的网络地址**

![luyou](./img/luyou.png)



---

::: tip 转发-在路由器中

:::

* 提取**目的网络地址**后查找**自身路由表**。确定**转发端口**， 以便进行转发
* **网络层**将**IP数据报**交付给**数据链路层**
* **数据链路层**给**IP数据报**添加一个**首部**和一个**尾部**，使之成为**帧**
* **数据链路层**将帧交付给**物理层**
* **物理层**先将**帧**看成**比特流**，这里的网络N2假设是以太网，所以**物理层**还会给该**比特流**前面添加**前导码**
* 物理层将装有**前导码**的**比特流**变换成相应的**信号**发送给传输媒体，信号通过传输媒体到达**Web服务器**

![luyou_out](./img/luyou_out.png)





**3、接收方接收**

> 和发送方（主机）发送过程的封装正好是反着来
>
> 在Web 服务器上
>
> * **物理层**将**信号**变换为**比特流**，然后去掉**前导码**后成为**帧**，交付给**数据链路层**
> * **数据链路层**将**帧**的**首部**和**尾部**去掉后成为**IP数据报**，将其交付给**网络层**
> * **网络层**将**IP数据报**的**首部**去掉后成为**TCP报文段**，将其交付给**运输层**
> * **运输层**将**TCP报文段**的**首部**去掉后成为**HTTP请求报文**，将其交付给**应用层**
> * **应用层**对**HTTP请求报文**进行**解析**，然后给主机发回**响应报文**
>
> **发回响应报文的步骤和之前过程类似**

![image-20201007155051275](./img/20201016104410.png)





## 5.4 专业术语

::: tip 实体
:::

- 实体：任何可发送或接收信息的硬件或软件进程
- 对等实体：收发双方相同层次中的实体

![image-20230510103301967](./img/image-20230510103301967.png)

---




::: tip 协议
:::

协议：控制两个对等实体进行逻辑通信的规则的集合

协议三要素：

* 语法：定义所交换信息的格式
* 语义：定义收发双方所要完成的操作
* 同步：定义收发双发的时序关系

![image-20230510103350741](./img/image-20230510103350741.png)

---






::: tip 服务
:::

![image-20230510103948192](./img/image-20230510103948192.png)

---

#### (1) 服务

在协议的控制下，两个对等实体间的逻辑通信使得本层能够向上一层提供服务。要实现本层协议，还需要使用下面一层所提供的服务。

- 协议是 "水平的"，服务是 "垂直的"。
- 实体看得见相邻下层所提供的服务，但并不知道实现该服务的具体协议。也就是说，下面的协议对上面的实体是"透明"的。

---

#### (2) 服务访问点

在同一系统中相邻两层的实体交换信息的逻辑接口，用于区分不同的服务类型。

- 数据链路层的服务访问点为帧的 "类型" 字段。
- 网络层的服务访问点为P数据报首部中的 "协议字段"。
- 运输层的服务访问点为 "端口号"。

---

#### (3) 服务原语

上层使用下层所提供的服务必须通过与下层交换一些命令，这些命令称为服务原语。

---

#### (4) 协议数据单元

对等层次之间传送的数据包称为该层的协议数据单元。

---

#### (5) 服务数据单元

同一系统内，层与层之间交换的数据包称为服务数据单元。



